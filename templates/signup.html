{% extends "homebase.html" %}
{% block title %}Sign Up{% endblock %}

{% block content %}


<div class="form-container">
    {% if error %}
    <div class="error">
        <span class="text">{{ error }}</span>
        <span id="close" class="material-symbols-outlined" onclick="console.log(this.parentElement.remove())">
            close
        </span>
    </div>
    {% endif %}


    <h1>Get Started!</h1>
    <span>Create an Account now and start your journey.</span>
    <hr style="opacity: 0;" />

    <form class="form" method="post">
        {{ form.csrf_token }}
        {{ form.username }}
        {{ form.email }}
        {{ form.password }}
        <div id="password-requirements" class="password-requirements" style="display: none;">
            <h4>Password Requirements:</h4>
            <ul>
                <li data-requirement="length">
                    <span class="icon">✗</span>
                    <span class="text">At least 8 characters long</span>
                </li>
                <li data-requirement="uppercase">
                    <span class="icon">✗</span>
                    <span class="text">At least one uppercase letter</span>
                </li>
                <li data-requirement="lowercase">
                    <span class="icon">✗</span>
                    <span class="text">At least one lowercase letter</span>
                </li>
                <li data-requirement="number">
                    <span class="icon">✗</span>
                    <span class="text">At least one number</span>
                </li>
                <li data-requirement="special">
                    <span class="icon">✗</span>
                    <span class="text">At least one special character (@$!%*#?&)</span>
                </li>
            </ul>
        </div>
        {{ form.conpassword }}
        {{ form.submit }}
    </form>

    <p>You Already have an Account? <a href="{{ url_for('login') }}">Log In</a></p>
</div>


<script>
    document.addEventListener('DOMContentLoaded', function () {
        const passwordInput = document.querySelector('input[name="password"]');
        const requirementsDiv = document.getElementById('password-requirements');
        
        function checkRequirements(password) {
            return {
                length: password.length >= 8,
                uppercase: /[A-Z]/.test(password),
                lowercase: /[a-z]/.test(password),
                number: /\d/.test(password),
                special: /[@$!%*#?&]/.test(password)
            };
        }

        function updateRequirements(password) {
            const requirements = checkRequirements(password);

            // Show requirements div when user starts typing
            if (password.length > 0) {
                requirementsDiv.classList.add('visible');
            } else {
                requirementsDiv.classList.remove('visible');
            }

            // Update each requirement's status
            Object.keys(requirements).forEach(requirement => {
                const li = requirementsDiv.querySelector(`li[data-requirement="${requirement}"]`);
                const icon = li.querySelector('.icon');

                if (requirements[requirement]) {
                    li.classList.add('met');
                    li.classList.remove('unmet');
                    icon.textContent = '✓';
                } else {
                    li.classList.add('unmet');
                    li.classList.remove('met');
                    icon.textContent = '✗';
                }
            });
        }

        passwordInput.addEventListener('input', function (e) {
            updateRequirements(e.target.value);
        });

        // Hide requirements initially
        passwordInput.addEventListener('focus', function () {
            if (this.value.length > 0) {
                requirementsDiv.classList.add('visible');
            }
        });
    });
</script>

{% endblock %}